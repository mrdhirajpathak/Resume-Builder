<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DP Resume Build</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- HTML2PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* --- Professional Color Palette & Variables --- */
        :root {
            /* Professional Blue Theme */
            --primary-color: #2c3e50; /* Dark Slate Blue */
            --accent-color: #3498db;  /* Bright Blue */
            --highlight-color: #e74c3c; /* Red highlight */
            --success-color: #27ae60;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --sidebar-bg: #ffffff;
            --text-main: #2c3e50;
            --text-muted: #7f8c8d;
            --border-color: #ecf0f1;
            --shadow-soft: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-card: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --primary-color: #ecf0f1;
            --accent-color: #3498db;
            --highlight-color: #e74c3c;
            --bg-gradient: linear-gradient(135deg, #232526 0%, #414345 100%);
            --sidebar-bg: #1e1e1e;
            --text-main: #ecf0f1;
            --text-muted: #bdc3c7;
            --border-color: #34495e;
            --shadow-soft: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* --- Animations for Headings --- */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* --- Global Styles --- */
        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            background: var(--bg-gradient);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0aec0; }

        /* --- App Container --- */
        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* --- Sidebar Styling --- */
        .sidebar {
            width: 40%;
            min-width: 400px;
            padding: 2rem;
            background-color: var(--sidebar-bg);
            box-shadow: 5px 0 15px rgba(0,0,0,0.05);
            overflow-y: auto;
            z-index: 10;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 1rem;
            animation: fadeInDown 0.6s ease-out; /* Header Animation */
        }

        .app-header h2 {
            margin: 0;
            font-weight: 700;
            color: var(--accent-color);
            font-size: 1.5rem;
            letter-spacing: -0.5px;
            text-transform: uppercase;
        }

        .app-header h2 i { margin-right: 10px; }

        /* --- Controls --- */
        .control-panel {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-muted);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        /* --- Tabs --- */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 2rem;
            animation: slideInLeft 0.5s ease-out 0.2s backwards;
        }

        .tab-link {
            padding: 0.6rem 1.2rem;
            border: none;
            background-color: transparent;
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }

        .tab-link:hover { background-color: rgba(52, 152, 219, 0.1); color: var(--accent-color); }
        
        .tab-link.active {
            background-color: var(--accent-color);
            color: white;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3);
        }

        /* --- Forms --- */
        .tab-content { display: none; animation: fadeInUp 0.4s ease-out; }
        .tab-content.active { display: block; }

        .form-group { margin-bottom: 1.2rem; position: relative; }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"], input[type="email"], input[type="tel"], textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--sidebar-bg);
            color: var(--text-main);
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        input:focus, textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea { resize: vertical; min-height: 100px; }

        .dynamic-list .item {
            background: var(--bg-gradient);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            position: relative;
            animation: fadeInUp 0.3s ease-out;
        }

        /* --- Buttons --- */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary { 
            background-color: var(--accent-color); 
            color: white; 
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3);
        }
        .btn-primary:hover { background-color: #2980b9; transform: translateY(-2px); }

        .btn-danger { background-color: var(--highlight-color); color: white; }
        .btn-danger:hover { background-color: #c0392b; }

        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; margin-top: 10px; }

        /* --- Resizer --- */
        .resizer {
            width: 8px;
            cursor: ew-resize;
            background-color: var(--border-color);
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .resizer:hover, .resizer:active { background-color: var(--accent-color); }

        /* --- Preview Panel --- */
        .preview-panel {
            width: 60%;
            padding: 2rem;
            background: var(--bg-gradient);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .preview-controls {
            width: 100%;
            max-width: 800px;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* --- Resume Paper Design --- */
        #resume-preview {
            width: 100%;
            max-width: 800px;
            aspect-ratio: 210 / 297;
            height: auto;
            background-color: white;
            box-shadow: var(--shadow-card);
            color: #333;
            font-family: 'Merriweather', serif; /* Serif for professional document look */
            font-size: 16px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Resume Internal Layout (Two Column Modern) --- */
        .resume-layout {
            display: flex;
            height: 100%;
        }

        .resume-left {
            width: 35%;
            background-color: #2c3e50; /* Professional Dark Blue Sidebar */
            color: white;
            padding: 2rem;
            text-align: left;
        }

        .resume-right {
            width: 65%;
            padding: 2rem;
            background-color: #fff;
        }

        /* Left Column Styling */
        #profile-pic-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 1.5rem auto;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid rgba(255,255,255,0.2);
            position: relative;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        #profile-pic-container:hover { border-color: var(--accent-color); }

        #resume-profile-pic {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #ecf0f1;
        }

        .left-section { margin-bottom: 2rem; }
        
        .left-section h3 {
            color: white;
            font-family: 'Poppins', sans-serif;
            text-transform: uppercase;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            letter-spacing: 1px;
            animation: slideInLeft 0.8s ease-out; /* Heading Animation */
        }

        .contact-item { 
            font-size: 0.8rem; 
            margin-bottom: 0.8rem; 
            display: flex; 
            align-items: center; 
            gap: 10px;
            word-break: break-all;
        }
        .contact-item i { width: 15px; color: #3498db; }
        .contact-item a { color: #bdc3c7; text-decoration: none; transition: color 0.2s; }
        .contact-item a:hover { color: white; }

        .skill-tag {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 0.8rem;
        }

        /* Right Column Styling */
        .header-name {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: #2c3e50;
            text-transform: uppercase;
            margin: 0;
            line-height: 1.1;
            animation: fadeInDown 0.8s ease-out; /* Name Animation */
        }

        .header-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            color: #3498db;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 0.5rem;
            margin-bottom: 2rem;
            font-weight: 500;
            animation: fadeInDown 1s ease-out; /* Title Animation */
        }

        .right-section { margin-bottom: 2rem; }

        .right-section h2 {
            font-family: 'Poppins', sans-serif;
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 700;
            text-transform: uppercase;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.3rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInLeft 0.6s ease-out; /* Heading Animation */
        }
        
        .right-section h2 i { color: #3498db; font-size: 1rem; }

        .entry-item { margin-bottom: 1.2rem; }
        .entry-title { font-weight: 700; font-size: 1rem; color: #333; }
        .entry-subtitle { font-style: italic; color: #666; font-size: 0.9rem; margin-bottom: 0.3rem; }
        .entry-content { font-size: 0.9rem; line-height: 1.6; color: #444; }

        /* Mobile Responsive */
        @media (max-width: 900px) {
            .app-container { flex-direction: column; overflow-y: auto; height: auto; }
            .sidebar { width: 100%; min-width: unset; height: auto; border-right: none; border-bottom: 1px solid var(--border-color); }
            .preview-panel { width: 100%; height: auto; }
            .resizer { display: none; }
            #resume-preview { flex-direction: column; height: auto; }
            .resume-left, .resume-right { width: 100%; }
        }

    </style>
</head>
<body>

    <div class="app-container">
        <!-- SIDEBAR EDITOR -->
        <div class="sidebar" id="sidebar">
            <div class="app-header">
                <h2><i class="fas fa-file-invoice"></i> DP Resume Build</h2>
                <div class="control-panel">
                    <button id="theme-toggle" class="btn-icon" title="Toggle Theme"><i class="fas fa-moon"></i></button>
                    <label for="import-json" class="btn-icon" title="Import Data"><i class="fas fa-file-import"></i></label>
                    <input type="file" id="import-json" accept=".json" style="display:none;">
                    <button id="export-json" class="btn-icon" title="Export Data"><i class="fas fa-file-export"></i></button>
                    <button id="reset-all" class="btn-icon" style="color: var(--highlight-color); border-color: var(--highlight-color);" title="Reset All"><i class="fas fa-trash-alt"></i></button>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="tabs">
                <button class="tab-link active" onclick="openTab(event, 'basic-info')"><i class="fas fa-user"></i> Profile</button>
                <button class="tab-link" onclick="openTab(event, 'experience')"><i class="fas fa-briefcase"></i> Experience</button>
                <button class="tab-link" onclick="openTab(event, 'education')"><i class="fas fa-graduation-cap"></i> Education</button>
                <button class="tab-link" onclick="openTab(event, 'projects')"><i class="fas fa-code"></i> Projects</button>
                <button class="tab-link" onclick="openTab(event, 'skills')"><i class="fas fa-cogs"></i> Skills</button>
                <button class="tab-link" onclick="openTab(event, 'more')"><i class="fas fa-plus-circle"></i> More</button>
            </div>
            
            <!-- Tab Contents -->
            <div id="basic-info" class="tab-content active">
                <div class="form-group">
                    <label>Profile Picture</label>
                    <input type="file" id="profile-pic-input" accept="image/*" onchange="handleImageUpload(event)">
                    <small style="color: var(--text-muted);">Click the circle in the preview to upload directly.</small>
                </div>
                <div class="form-group"><label for="name">Full Name</label><input type="text" id="name" oninput="updatePreview()" placeholder="e.g. John Doe"></div>
                <div class="form-group"><label for="title">Professional Title</label><input type="text" id="title" oninput="updatePreview()" placeholder="e.g. Senior Software Engineer"></div>
                <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" oninput="updatePreview()" placeholder="john@example.com"></div>
                <div class="form-group"><label for="phone">Phone Number</label><input type="tel" id="phone" oninput="updatePreview()" placeholder="+1 234 567 890"></div>
                <div class="form-group"><label for="linkedin">LinkedIn URL</label><input type="text" id="linkedin" oninput="updatePreview()" placeholder="linkedin.com/in/johndoe"></div>
                <div class="form-group"><label for="github">GitHub / Portfolio URL</label><input type="text" id="github" oninput="updatePreview()" placeholder="github.com/johndoe"></div>
                <div class="form-group"><label for="location">Location</label><input type="text" id="location" oninput="updatePreview()" placeholder="New York, USA"></div>
                <div class="form-group"><label for="summary">Professional Summary</label><textarea id="summary" oninput="updatePreview()" placeholder="Briefly describe your career highlights..."></textarea></div>
            </div>

            <div id="experience" class="tab-content">
                <button class="btn btn-primary" style="width:100%; margin-bottom:1rem;" onclick="addExperience()"><i class="fas fa-plus"></i> Add Job Position</button>
                <div id="experience-list" class="dynamic-list"></div>
            </div>

            <div id="education" class="tab-content">
                <button class="btn btn-primary" style="width:100%; margin-bottom:1rem;" onclick="addEducation()"><i class="fas fa-plus"></i> Add Education</button>
                <div id="education-list" class="dynamic-list"></div>
            </div>

            <div id="projects" class="tab-content">
                <button class="btn btn-primary" style="width:100%; margin-bottom:1rem;" onclick="addProject()"><i class="fas fa-plus"></i> Add Project</button>
                <div id="project-list" class="dynamic-list"></div>
            </div>

            <div id="skills" class="tab-content">
                <div class="form-group">
                    <label for="skills-input">Technical Skills</label>
                    <textarea id="skills-input" oninput="updatePreview()" placeholder="Java, Python, React, Team Leadership (Comma separated)"></textarea>
                </div>
            </div>

            <div id="more" class="tab-content">
                 <div class="form-group">
                    <label>Languages</label>
                    <input type="text" id="languages-input" oninput="updatePreview()" placeholder="English, Spanish, Hindi">
                </div>
                 <div class="form-group">
                    <label>Hobbies & Interests</label>
                    <input type="text" id="hobbies-input" oninput="updatePreview()" placeholder="Photography, Chess, Hiking">
                </div>
                <hr style="border:0; border-top:1px solid var(--border-color); margin: 1.5rem 0;">
                <button class="btn btn-primary" style="width:100%; margin-bottom:1rem;" onclick="addCertification()"><i class="fas fa-certificate"></i> Add Certification</button>
                <div id="certification-list" class="dynamic-list"></div>
                <button class="btn btn-primary" style="width:100%; margin-bottom:1rem;" onclick="addAchievement()"><i class="fas fa-trophy"></i> Add Achievement</button>
                <div id="achievement-list" class="dynamic-list"></div>
            </div>

        </div>

        <!-- RESIZER -->
        <div class="resizer" id="resizer" title="Drag to resize">||</div>
        
        <!-- PREVIEW PANEL -->
        <div class="preview-panel">
            <div class="preview-controls">
                <button id="download-pdf" class="btn btn-primary"><i class="fas fa-file-download"></i> Download PDF</button>
            </div>
            
            <!-- RESUME PREVIEW AREA -->
            <div id="resume-preview">
                <div class="resume-layout">
                    <!-- LEFT SIDEBAR OF RESUME -->
                    <div class="resume-left">
                        <div id="profile-pic-container" onclick="document.getElementById('profile-pic-input').click()">
                            <img id="resume-profile-pic" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Profile">
                        </div>
                        
                        <div class="left-section">
                            <h3>Contact</h3>
                            <div class="contact-info">
                                <div id="resume-email-container" class="contact-item"><i class="fas fa-envelope"></i> <a id="resume-email" href="#"></a></div>
                                <div id="resume-phone-container" class="contact-item"><i class="fas fa-phone"></i> <span id="resume-phone"></span></div>
                                <div id="resume-location-container" class="contact-item"><i class="fas fa-map-marker-alt"></i> <span id="resume-location"></span></div>
                                <div id="resume-linkedin-container" class="contact-item"><i class="fab fa-linkedin"></i> <a id="resume-linkedin" href="#"></a></div>
                                <div id="resume-github-container" class="contact-item"><i class="fab fa-github"></i> <a id="resume-github" href="#"></a></div>
                            </div>
                        </div>

                        <div id="skills-section" class="left-section">
                            <h3>Skills</h3>
                            <div id="resume-skills" style="line-height: 1.6; font-size: 0.9rem;"></div>
                        </div>

                        <div id="languages-section" class="left-section">
                            <h3>Languages</h3>
                            <p id="resume-languages" style="font-size: 0.9rem;"></p>
                        </div>
                        
                         <div id="hobbies-section" class="left-section">
                            <h3>Interests</h3>
                            <p id="resume-hobbies" style="font-size: 0.9rem;"></p>
                        </div>
                    </div>

                    <!-- RIGHT MAIN CONTENT OF RESUME -->
                    <div class="resume-right">
                        <div class="header-text">
                            <h1 id="resume-name" class="header-name">YOUR NAME</h1>
                            <p id="resume-title" class="header-title">PROFESSIONAL TITLE</p>
                        </div>

                        <div id="summary-section" class="right-section">
                            <h2><i class="fas fa-user-circle"></i> Profile</h2>
                            <p id="resume-summary" class="entry-content"></p>
                        </div>

                        <div id="experience-section" class="right-section">
                            <h2><i class="fas fa-briefcase"></i> Experience</h2>
                            <div id="resume-experience"></div>
                        </div>

                        <div id="education-section" class="right-section">
                            <h2><i class="fas fa-graduation-cap"></i> Education</h2>
                            <div id="resume-education"></div>
                        </div>

                        <div id="projects-section" class="right-section">
                            <h2><i class="fas fa-rocket"></i> Projects</h2>
                            <div id="resume-projects"></div>
                        </div>
                        
                        <div id="certifications-section" class="right-section">
                            <h2><i class="fas fa-certificate"></i> Certifications</h2>
                            <div id="resume-certifications"></div>
                        </div>

                         <div id="achievements-section" class="right-section">
                            <h2><i class="fas fa-award"></i> Achievements</h2>
                            <div id="resume-achievements"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const resizer = document.getElementById('resizer');
        const previewPanel = document.querySelector('.preview-panel');

        // State
        let resumeData = {};
        
        // --- Core Functions ---

        function openTab(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }
            tablinks = document.getElementsByClassName("tab-link");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            const activeTab = document.getElementById(tabName);
            activeTab.style.display = "block";
            // Trigger reflow for animation
            void activeTab.offsetWidth; 
            activeTab.classList.add("active");
            evt.currentTarget.className += " active";
        }
        
        function updatePreview() {
            // Basic Info
            const name = document.getElementById('name').value;
            const title = document.getElementById('title').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const linkedin = document.getElementById('linkedin').value;
            const github = document.getElementById('github').value;
            const location = document.getElementById('location').value;
            const summary = document.getElementById('summary').value;

            document.getElementById('resume-name').innerText = name || 'YOUR NAME';
            document.getElementById('resume-title').innerText = title || 'PROFESSIONAL TITLE';
            
            document.getElementById('resume-email').innerText = email;
            document.getElementById('resume-email').href = 'mailto:' + email;
            document.getElementById('resume-email-container').style.display = email ? 'flex' : 'none';

            document.getElementById('resume-phone').innerText = phone;
            document.getElementById('resume-phone-container').style.display = phone ? 'flex' : 'none';

            document.getElementById('resume-location').innerText = location;
            document.getElementById('resume-location-container').style.display = location ? 'flex' : 'none';

            const linkedinText = linkedin.replace(/^(https?:\/\/)?(www\.)?linkedin\.com\/in\//, '');
            document.getElementById('resume-linkedin').innerText = linkedinText.substring(0, 25) + (linkedinText.length > 25 ? '...' : '');
            document.getElementById('resume-linkedin').href = linkedin.startsWith('http') ? linkedin : 'https://' + linkedin;
            document.getElementById('resume-linkedin-container').style.display = linkedin ? 'flex' : 'none';

            const githubText = github.replace(/^(https?:\/\/)?(www\.)?github\.com\//, '');
            document.getElementById('resume-github').innerText = githubText.substring(0, 25) + (githubText.length > 25 ? '...' : '');
            document.getElementById('resume-github').href = github.startsWith('http') ? github : 'https://' + github;
            document.getElementById('resume-github-container').style.display = github ? 'flex' : 'none';

            document.getElementById('resume-summary').innerText = summary;
            document.getElementById('summary-section').style.display = summary ? 'block' : 'none';

            // Dynamic sections
            updateListPreview('experience-list', 'resume-experience', 'experience-section', item => `
                <div class="entry-item">
                    <div class="entry-title">${item.querySelector('.experience-title').value}</div>
                    <div class="entry-subtitle">${item.querySelector('.experience-company').value} | ${item.querySelector('.experience-dates').value}</div>
                    <div class="entry-content">${item.querySelector('.experience-desc').value.replace(/\n/g, '<br>')}</div>
                </div>`);

            updateListPreview('education-list', 'resume-education', 'education-section', item => `
                <div class="entry-item">
                    <div class="entry-title">${item.querySelector('.education-degree').value}</div>
                    <div class="entry-subtitle">${item.querySelector('.education-school').value}</div>
                    <div class="entry-subtitle">${item.querySelector('.education-year').value}</div>
                </div>`);
            
            updateListPreview('project-list', 'resume-projects', 'projects-section', item => `
                <div class="entry-item">
                    <div class="entry-title">${item.querySelector('.project-name').value}</div>
                    <div class="entry-content">${item.querySelector('.project-desc').value.replace(/\n/g, '<br>')}</div>
                </div>`);

            updateListPreview('certification-list', 'resume-certifications', 'certifications-section', item => `
                <div class="entry-item">
                    <div class="entry-content"><strong>${item.querySelector('.cert-name').value}</strong> – ${item.querySelector('.cert-provider').value} (${item.querySelector('.cert-year').value})</div>
                </div>`);

            updateListPreview('achievement-list', 'resume-achievements', 'achievements-section', item => `
                <div class="entry-item">
                   <div class="entry-content"><strong>${item.querySelector('.achieve-name').value}</strong> – ${item.querySelector('.achieve-rank').value} (${item.querySelector('.achieve-year').value})</div>
                </div>`);

            // Skills - Special Tag formatting
            const skillsInput = document.getElementById('skills-input').value;
            const skillsContainer = document.getElementById('resume-skills');
            skillsContainer.innerHTML = '';
            if (skillsInput.trim()) {
                skillsInput.split(',').forEach(skill => {
                    if (skill.trim()) {
                        const tag = document.createElement('span');
                        tag.className = 'skill-tag';
                        tag.innerText = skill.trim();
                        skillsContainer.appendChild(tag);
                    }
                });
                document.getElementById('skills-section').style.display = 'block';
            } else {
                document.getElementById('skills-section').style.display = 'none';
            }

            updateTextPreview('languages-input', 'resume-languages', 'languages-section');
            updateTextPreview('hobbies-input', 'resume-hobbies', 'hobbies-section');

            saveToLocal();
            
            // Adjust font size after content is updated
            adjustFontSizeToFit();
        }

        // --- Smart Layout Function ---
        function adjustFontSizeToFit() {
            const preview = document.getElementById('resume-preview');
            const MAX_FONT_SIZE = 16;
            const MIN_FONT_SIZE = 10;
            const STEP = 0.5;

            // Reset to max font size
            preview.style.fontSize = MAX_FONT_SIZE + 'px';

            // Shrink if needed
            let safetyCounter = 50; 
            while (preview.scrollHeight > preview.clientHeight && safetyCounter > 0) {
                const currentSize = parseFloat(window.getComputedStyle(preview).fontSize);
                if (currentSize <= MIN_FONT_SIZE) {
                    break; 
                }
                const newSize = currentSize - STEP;
                preview.style.fontSize = newSize + 'px';
                safetyCounter--;
            }
        }

        // --- Helper Functions for updatePreview ---

        function updateListPreview(listId, previewId, sectionId, formatter) {
            const list = document.getElementById(listId).children;
            const previewContainer = document.getElementById(previewId);
            previewContainer.innerHTML = '';
            let hasContent = false;
            for (let item of list) {
                if (Array.from(item.querySelectorAll('input, textarea')).some(input => input.value.trim() !== '')) {
                    previewContainer.innerHTML += formatter(item);
                    hasContent = true;
                }
            }
            document.getElementById(sectionId).style.display = hasContent ? 'block' : 'none';
        }
        
        function updateTextPreview(inputId, previewId, sectionId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            preview.innerText = input.value;
            document.getElementById(sectionId).style.display = input.value.trim() ? 'block' : 'none';
        }

        // --- Dynamic Form Addition ---

        const createItemHTML = (fields) => {
            const item = document.createElement('div');
            item.className = 'item';
            let html = '';
            fields.forEach(({label, type, className, placeholder}) => {
                html += `<div class="form-group"><label>${label}</label>`;
                if (type === 'textarea') {
                    html += `<textarea class="${className}" oninput="updatePreview()" placeholder="${placeholder || ''}"></textarea>`;
                } else {
                    html += `<input type="text" class="${className}" oninput="updatePreview()" placeholder="${placeholder || ''}">`;
                }
                html += `</div>`;
            });
            html += `<button class="btn btn-danger btn-sm" onclick="this.parentElement.remove(); updatePreview()"><i class="fas fa-trash"></i> Remove</button>`;
            item.innerHTML = html;
            return item;
        };
        
        function addExperience() {
            document.getElementById('experience-list').appendChild(createItemHTML([
                {label: 'Job Title', type: 'text', className: 'experience-title', placeholder: 'e.g. Product Manager'},
                {label: 'Company', type: 'text', className: 'experience-company', placeholder: 'e.g. Google'},
                {label: 'Dates', type: 'text', className: 'experience-dates', placeholder: 'e.g. Jan 2020 - Present'},
                {label: 'Description', type: 'textarea', className: 'experience-desc', placeholder: 'Key achievements...'},
            ]));
        }

        function addEducation() {
            document.getElementById('education-list').appendChild(createItemHTML([
                {label: 'Degree', type: 'text', className: 'education-degree', placeholder: 'e.g. B.Tech in CS'},
                {label: 'School/University', type: 'text', className: 'education-school', placeholder: 'e.g. MIT'},
                {label: 'Year', type: 'text', className: 'education-year', placeholder: 'e.g. 2023'},
            ]));
        }

        function addProject() {
            document.getElementById('project-list').appendChild(createItemHTML([
                {label: 'Project Name', type: 'text', className: 'project-name', placeholder: 'e.g. E-commerce App'},
                {label: 'Description', type: 'textarea', className: 'project-desc', placeholder: 'Tech stack used and impact...'},
            ]));
        }
        
        function addCertification() {
            document.getElementById('certification-list').appendChild(createItemHTML([
                {label: 'Course Name', type: 'text', className: 'cert-name', placeholder: 'AWS Solution Architect'},
                {label: 'Provider', type: 'text', className: 'cert-provider', placeholder: 'Amazon'},
                {label: 'Year', type: 'text', className: 'cert-year', placeholder: '2023'},
            ]));
        }

        function addAchievement() {
             document.getElementById('achievement-list').appendChild(createItemHTML([
                {label: 'Achievement Name', type: 'text', className: 'achieve-name', placeholder: 'Hackathon Winner'},
                {label: 'Year', type: 'text', className: 'achieve-year', placeholder: '2022'},
                {label: 'Rank/Detail', type: 'text', className: 'achieve-rank', placeholder: '1st Place'},
            ]));
        }

        // --- Image Handling ---

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('resume-profile-pic').src = e.target.result;
                updatePreview();
            };
            reader.readAsDataURL(file);
        }

        // --- Data Persistence (LocalStorage) ---

        function saveToLocal() {
            resumeData = {
                profilePic: document.getElementById('resume-profile-pic').src,
                name: document.getElementById('name').value,
                title: document.getElementById('title').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                location: document.getElementById('location').value,
                linkedin: document.getElementById('linkedin').value,
                github: document.getElementById('github').value,
                summary: document.getElementById('summary').value,
                skills: document.getElementById('skills-input').value,
                languages: document.getElementById('languages-input').value,
                hobbies: document.getElementById('hobbies-input').value,
                education: Array.from(document.getElementById('education-list').children).map(item => ({
                    degree: item.querySelector('.education-degree').value,
                    school: item.querySelector('.education-school').value,
                    year: item.querySelector('.education-year').value
                })),
                experience: Array.from(document.getElementById('experience-list').children).map(item => ({
                    title: item.querySelector('.experience-title').value, company: item.querySelector('.experience-company').value,
                    dates: item.querySelector('.experience-dates').value, desc: item.querySelector('.experience-desc').value
                })),
                projects: Array.from(document.getElementById('project-list').children).map(item => ({
                    name: item.querySelector('.project-name').value, desc: item.querySelector('.project-desc').value
                })),
                certifications: Array.from(document.getElementById('certification-list').children).map(item => ({
                    name: item.querySelector('.cert-name').value, provider: item.querySelector('.cert-provider').value, year: item.querySelector('.cert-year').value
                })),
                achievements: Array.from(document.getElementById('achievement-list').children).map(item => ({
                    name: item.querySelector('.achieve-name').value, year: item.querySelector('.achieve-year').value,
                    rank: item.querySelector('.achieve-rank').value
                }))
            };
            localStorage.setItem('dpResumeData', JSON.stringify(resumeData));
        }
        
        function loadFromLocal() {
            const data = JSON.parse(localStorage.getItem('dpResumeData'));
            if (!data) return;
            
            if(data.profilePic) document.getElementById('resume-profile-pic').src = data.profilePic;
            document.getElementById('name').value = data.name || '';
            document.getElementById('title').value = data.title || '';
            document.getElementById('email').value = data.email || '';
            document.getElementById('phone').value = data.phone || '';
            document.getElementById('location').value = data.location || '';
            document.getElementById('linkedin').value = data.linkedin || '';
            document.getElementById('github').value = data.github || '';
            document.getElementById('summary').value = data.summary || '';
            document.getElementById('skills-input').value = data.skills || '';
            document.getElementById('languages-input').value = data.languages || '';
            document.getElementById('hobbies-input').value = data.hobbies || '';
            
            data.education?.forEach(edu => { addEducation(); const item = document.getElementById('education-list').lastChild; item.querySelector('.education-degree').value = edu.degree; item.querySelector('.education-school').value = edu.school; item.querySelector('.education-year').value = edu.year; });
            data.experience?.forEach(exp => { addExperience(); const item = document.getElementById('experience-list').lastChild; item.querySelector('.experience-title').value = exp.title; item.querySelector('.experience-company').value = exp.company; item.querySelector('.experience-dates').value = exp.dates; item.querySelector('.experience-desc').value = exp.desc; });
            data.projects?.forEach(proj => { addProject(); const item = document.getElementById('project-list').lastChild; item.querySelector('.project-name').value = proj.name; item.querySelector('.project-desc').value = proj.desc; });
            data.certifications?.forEach(cert => { addCertification(); const item = document.getElementById('certification-list').lastChild; item.querySelector('.cert-name').value = cert.name; item.querySelector('.cert-provider').value = cert.provider; item.querySelector('.cert-year').value = cert.year; });
            data.achievements?.forEach(achieve => { addAchievement(); const item = document.getElementById('achievement-list').lastChild; item.querySelector('.achieve-name').value = achieve.name; item.querySelector('.achieve-year').value = achieve.year; item.querySelector('.achieve-rank').value = achieve.rank; });

            updatePreview();
        }

        // --- Event Listeners & Initializers ---

        document.getElementById('theme-toggle').addEventListener('click', () => {
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            const icon = document.querySelector('#theme-toggle i');
            icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        });

        document.getElementById('download-pdf').addEventListener('click', () => {
            const element = document.getElementById('resume-preview');
            // Optimizations for better PDF quality
            const opt = { 
                margin: 0, 
                filename: 'DP_Resume.pdf', 
                image: { type: 'jpeg', quality: 0.98 }, 
                html2canvas: { scale: 2, useCORS: true }, 
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } 
            };
            
            // Temporarily fix height for PDF generation if needed or just generate
            html2pdf().from(element).set(opt).save();
        });

        document.getElementById('export-json').addEventListener('click', () => {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(resumeData));
            const dl = document.createElement('a');
            dl.setAttribute("href", dataStr);
            dl.setAttribute("download", "dp-resume-data.json");
            document.body.appendChild(dl);
            dl.click();
            dl.remove();
        });

        document.getElementById('import-json').addEventListener('change', e => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                localStorage.setItem('dpResumeData', event.target.result);
                window.location.reload();
            };
            reader.readAsText(file);
        });

        document.getElementById('reset-all').addEventListener('click', () => {
            if (confirm('Are you sure you want to delete all resume data?')) {
                localStorage.removeItem('dpResumeData');
                window.location.reload();
            }
        });

        // Resizable sidebar logic
        let isResizing = false;
        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.removeEventListener('mousemove', handleMouseMove);
            });
        });

        function handleMouseMove(e) {
            if (!isResizing) return;
            requestAnimationFrame(() => {
                const sidebarWidth = e.clientX;
                if(sidebarWidth > 300 && sidebarWidth < window.innerWidth - 400) {
                    sidebar.style.width = `${sidebarWidth}px`;
                    previewPanel.style.width = `calc(100% - ${sidebarWidth}px)`;
                }
            });
        }

        // Initial Load
        window.onload = () => {
            loadFromLocal();
            // Load dummy fields if empty for better UX
            if (!localStorage.getItem('dpResumeData')) {
                addExperience();
                addEducation();
            }
            updatePreview();
        };

    </script>
</body>
</html>
